:ruby
  song = data.songs[song_title]
  current_page.data.title = "#{song_title} (Key of #{song[:music_key]})"

%nav
  = link_to "Back", '/'

%article
  %h1
    = current_page.data.title

  %table
    - song.lyrics.each do |verse|
      :ruby
        verse_repeated = !verse.is_a?(Hash)
        verse_title = verse.is_a?(Hash) ? verse.keys[0] : "Repeat #{verse}"
        verse_lyrics = verse.is_a?(Hash) ? verse.values[0] : '&hellip;'
        verse_chords = song.chords[verse_title] || '&hellip;'
        verse_lyrics_lines = verse_lyrics.split("\n")
        verse_chords_lines = verse_chords.split("\n")

      %tr
        %th{colspan: 2}
          = verse_title

      - verse_lyrics_lines.each.with_index do |lyrics_line, i|
        :ruby
          tr_classes = []

          if i == verse_lyrics_lines.size - 1
            tr_classes << 'verse-lyrics-line--last'
          end

          tr_classes << 'verse-lyrics-line--space' if lyrics_line.blank?

        - unless verse_repeated
          %tr{ class: tr_classes }
            %td
              = lyrics_line

            %td.chords
              = verse_chords_lines[i]
